"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Context = void 0;
var sp_request_1 = require("sp-request");
var Context = (function () {
    function Context(context) {
        var _this = this;
        this.initContext = function (context) {
            _this.spr = (0, sp_request_1.create)(context);
        };
        this.initContext(context);
    }
    Context.prototype.getWebByAnyChildUrl = function (anyChildUrl) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var restUrl = anyChildUrl + "/_api/web?$select=Url,ServerRelativeUrl";
            _this.spr.get(restUrl, {
                headers: {
                    'Accept': 'application/json;odata=verbose'
                }
            })
                .then(function (response) { return resolve(response.body.d); })
                .catch(function (err) {
                if (err.response.statusCode === 404) {
                    var childUrlArr = anyChildUrl.split('/');
                    childUrlArr.pop();
                    var childUrl = childUrlArr.join('/');
                    if (childUrlArr.length <= 2) {
                        return reject("Wrong url, can't get Web property");
                    }
                    else {
                        return resolve(_this.getWebByAnyChildUrl(childUrl));
                    }
                }
                else {
                    return reject(err);
                }
            });
        });
    };
    return Context;
}());
exports.Context = Context;
//# sourceMappingURL=context.js.map